{"version":3,"sources":["eventHandler.js"],"names":["orienterStartRotateX","orienterStartRotateY","throttle","fn","delay","mustRunDelay","timer","t_start","context","args","arguments","t_curr","Date","clearTimeout","apply","setTimeout","bodyMoving","handler","$body","$","startX","startY","p","on","e","touch","touches","clientX","clientY","start","preventDefault","pdiffX","Math","abs","diffX","diffY","moving","end","moveToInitZ","requestAnimationFrame","currentZ","parseInt","anime","getValue","stage","a","initStageTranslateZ","$stage","css","transform","bodyOnTouchHandler","stopOrienter","startRotateY","parseFloat","sliceWrap","startRotateX","X","rotateY","imageNumber","imageWidth","rotateX","allowRotateX","$sliceWrap","sliceWrapTranslateZ","z","tz","window","first","orienter","o","Orienter","latitude","longitude","obj","lat","lon","Y","html","init","pos","console","log"],"mappings":"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","file":"eventHandler.js","sourcesContent":["let orienterStartRotateX = 0;\nlet orienterStartRotateY = 0;\n\n\n\nvar throttle = function(fn, delay, mustRunDelay){\n \tvar timer = null;\n \tvar t_start;\n \treturn function(){\n \t\tvar context = this, args = arguments, t_curr = +new Date();\n \t\tclearTimeout(timer);\n \t\tif(!t_start){\n \t\t\tt_start = t_curr;\n \t\t}\n \t\tif(t_curr - t_start >= mustRunDelay){\n \t\t\tfn.apply(context, args);\n \t\t\tt_start = t_curr;\n \t\t}\n \t\telse {\n \t\t\ttimer = setTimeout(function(){\n \t\t\t\tfn.apply(context, args);\n \t\t\t}, delay);\n \t\t}\n \t};\n };\n\nfunction bodyMoving(handler) {\n    let $body = $('body');\n\n    let startX = 0;\n    let startY = 0;\n\n\n    let p = 0;\n\n    $body.on('touchstart', (e) => {\n        let touch = e.touches[0];\n\n        startX = touch.clientX;\n        startY = touch.clientY;\n\n        touch.startX = startX;\n        touch.startY = startY;\n        p = touch.clientX;\n\n        handler.start && handler.start(touch);\n\n    });\n\n    $body.on('touchmove', (e) => {\n        e.preventDefault();\n\n        let touch = e.touches[0];\n\n        touch.pdiffX = Math.abs(touch.clientX - p);\n        p = touch.clientX;\n\n        // console.log(touch.pdiffX);\n        touch.diffX = touch.clientX - startX;\n        touch.diffY = touch.clientY - startY;\n\n        handler.moving && handler.moving(touch);\n\n    });\n    $body.on('touchend', (e) => {\n        let touch = e.touches[0];\n        handler.end && handler.end(touch)\n    });\n}\n\n\n\n(function moveToInitZ() {\n    \n    requestAnimationFrame(moveToInitZ);\n    let currentZ = parseInt(anime.getValue(stage, 'translateZ'));\n\n    let a = (currentZ + initStageTranslateZ*2) / 3;\n    $stage.css({\n        transform: `translateZ(${a}px)`\n    })\n})()\n\nconst bodyOnTouchHandler = {};\n\nbodyOnTouchHandler.start = function(touch) {\n    stopOrienter = true;\n    this.startRotateY = parseFloat(anime.getValue(sliceWrap, 'rotateY'));\n    this.startRotateX = parseFloat(anime.getValue(sliceWrap, 'rotateX'));\n}\n\nbodyOnTouchHandler.moving = function(touch) {\n    throttle((X) => {\n\n    let rotateY = this.startRotateY - (touch.diffX / (imageNumber * imageWidth) * 360 * 1.5);\n    let rotateX = this.startRotateX + (touch.diffY / (imageNumber * imageWidth) * 360 * 1.5);\n\n    if(rotateX > allowRotateX) {\n        rotateX = allowRotateX;\n    } else if(rotateX < -allowRotateX) {\n        rotateX = -allowRotateX;\n    }\n\n\n    $sliceWrap.css({\n        transform: `translateZ(${sliceWrapTranslateZ}px) \n                    rotateX(${rotateX}deg) \n                    rotateY(${rotateY}deg)`,\n    });\n\n\n        requestAnimationFrame(() => {\n            let z = parseFloat(anime.getValue(stage, 'translateZ'));\n\n\n\n            let tz = z - X * 30;\n            let a = (z + tz ) / 2;\n            $stage.css({\n                transform: `translateZ(${a}px)`\n            })\n        })\n\n    }, 0, 100)(touch.pdiffX);\n\n    \n\n};\n\n\nbodyOnTouchHandler.end = function() {\n    window.orienterStartRotateX = parseFloat(anime.getValue(sliceWrap, 'rotateX'));\n    window.orienterStartRotateY = parseFloat(anime.getValue(sliceWrap, 'rotateY'));\n    stopOrienter = false;\n}\n\n\nbodyMoving(bodyOnTouchHandler);\n\n// 以下是重力感应\n\nlet first = true;\nfunction orienter(handler) {\n    let  o = new Orienter();\n    let latitude = 0;\n    let longitude = 0;\n    let p = 0;\n    o.handler = (obj) => {\n        if(first) {\n            latitude = obj.lat; // 维度\n            longitude = obj.lon;// 经度\n            first = false;\n            handler.start && handler.start({\n                Y: latitude,\n                X: longitude\n            });\n            p = longitude;\n            return;\n        }\n\n        let diffY = obj.lat - latitude;\n        let diffX = obj.lon - longitude;\n        let pdiffX = Math.abs(longitude - p);\n\n        $('#test').html(`pdiffX, ${pdiffX}`);\n        handler.moving && handler.moving({\n            diffX,\n            diffY,\n            pdiffX\n        });\n    }\n    o.init();\n}\n\n\n\n\norienter({\n    start: (pos) => {\n        orienterStartRotateX = parseFloat(anime.getValue(sliceWrap, 'rotateX'));\n        orienterStartRotateY = parseFloat(anime.getValue(sliceWrap, 'rotateY'))\n    }, \n\n    moving: throttle((pos) => {\n\n        if(stopOrienter === true) {\n            first = true;    \n            return;\n        }\n\n\n        let rotateX = orienterStartRotateX + (pos.diffY/2);\n        let rotateY = orienterStartRotateY - pos.diffX;\n        let X = pos.pdiffX;\n\n        if(rotateX > 40) {\n            rotateX = 40;\n        } else if(rotateX < -40) {\n            rotateX = -40;\n        }\n\n        console.log(X);\n\n        // $sliceWrap.animate({\n        //     translateZ: `${sliceWrapTranslateZ}px`,\n        //     rotateX: `${rotateX}deg`,\n        //     rotateY: `${rotateY}deg`\n        // }, 0)\n        \n\n\n        $sliceWrap.css({ \n            transform: `translateZ(${sliceWrapTranslateZ}px)  \n                        rotateX(${rotateX}deg) \n                        rotateY(${rotateY}deg)`,\n        })\n\n\n        requestAnimationFrame(() => {\n            let z = parseFloat(anime.getValue(stage, 'translateZ'));\n\n            let tz = z - X * 3;\n            let a = (z + tz ) / 2;\n            $stage.css({\n                transform: `translateZ(${a}px)`\n            })\n        })\n    \n    }, 1000/60, 500)\n\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"],"sourceRoot":"/source/"}